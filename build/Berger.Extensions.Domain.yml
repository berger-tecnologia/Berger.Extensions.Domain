trigger:
  branches:
    include:
    - main
name: 1.0.0$(Rev:.r)

variables:
  buildConfiguration: 'Release'

resources:
  repositories:
  - repository: self
    type: git
    ref: refs/heads/dev

jobs:
- job: Job_1
  displayName: Berger.Extensions.Domain-Agent
  pool:
    vmImage: windows-latest
  steps:
  - checkout: self
    clean: true
    fetchTags: false

  - task: UseDotNet@2
    displayName: dotnet core sdk 7.x use
    inputs:
      version: 7.x

  - task: DotNetCoreCLI@2
    displayName: dotnet restore
    inputs:
      command: restore
      projects: '**/*.csproj'
      arguments: '/property:UseProjectReference=false'

  - task: DotNetCoreCLI@2
    displayName: 'dotnet build'
    inputs:
      projects: '**/*.csproj'
      arguments: '--configuration $(buildConfiguration) /property:UseProjectReference=false'

  - task: DotNetCoreCLI@2
    displayName: dotnet pack
    inputs:
      command: pack
      arguments: '/property:UseProjectReference=false'
      versioningScheme: byBuildNumber

  - task: NuGetCommand@2
    displayName: nuget push
    inputs:
      command: push
      nuGetFeedType: external
      publishFeedCredentials: 'berger.extensions.nuget'